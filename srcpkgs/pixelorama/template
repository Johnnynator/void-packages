# Template file for 'pixelorama'
pkgname=pixelorama
version=0.11.3.1
_commit=33ffa88a5b8edec7dc4827c48d70e476fe4dff37
revision=1
build_style=godot
hostmakedepends="godot"
makedepends="godot-template-release"
depends="godot-template-release>=4<5"
short_desc="2D sprite editor, made with the Godot Engine"
maintainer="John <me@johnnynator.dev>"
license="MIT"
homepage="https://orama-interactive.itch.io/pixelorama"
distfiles="https://github.com/Orama-Interactive/Pixelorama/archive/${_commit}.tar.gz"
checksum=1f542ad919a563d65c3735209a30ab66306b200063b72180176ef3f381acd948

do_configure() {
	case "$XBPS_TARGET_MACHINE" in
		i686*) godot_arch="x86_32" ;;
		x86_64*) godot_arch="x86_64" ;;
		aarch64*) godot_arch="arm64" ;;
		armv7*) godot_arch="arm32" ;;
		ppc64*) godot_arch="ppc64" ;;
		riscv64*) godot_arch="rv64" ;;
	esac

	cat > export_presets.cfg <<-_EOF
	[preset.0]

	name="Void"
	platform="Linux/X11"
	runnable=false
	dedicated_server=false
	custom_features=""
	export_filter="all_resources"
	include_filter=""
	exclude_filter=""
	export_path=""
	encryption_include_filters=""
	encryption_exclude_filters=""
	encrypt_pck=false
	encrypt_directory=false

	[preset.0.options]

	custom_template/debug="${XBPS_CROSS_BASE}/usr/bin/godot-template-debug"
	custom_template/release="${XBPS_CROSS_BASE}/usr/bin/godot-template-release"
	debug/export_console_wrapper=1
	binary_format/embed_pck=false
	texture_format/bptc=true
	texture_format/s3tc=true
	texture_format/etc=false
	texture_format/etc2=false
	binary_format/architecture="${godot_arch}"
	binary_format/64_bits=true
	texture_format/no_bptc_fallbacks=true
	_EOF

}

do_build() {
	mkdir -p build
	godot --headless -v --export-pack "Void" ./build/${pkgname}.pck
}

do_install() {
	vlicense LICENSE
	vinstall build/${pkgname}.pck 644 usr/share/${pkgname}
	cat > run.sh <<-_EOF
	#!/bin/sh
	exec godot-template-release --main-pack /usr/share/${pkgname}/${pkgname}.pck $@
	_EOF
	vbin run.sh ${pkgname}
}
