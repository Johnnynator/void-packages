# Template file for 'rpcs3'
pkgname=rpcs3
version=0.0.18
revision=1
_rpcs3_commit=8b4f3fa7756b2f107de06cdeeed70d8e4ef67de9
_ffmpeg_commit=e5fb13bbb07ac3ba2e1998e2f5688f3714870d93
_asmjit_commit=723f58581afc0f4cb16ba13396ff77e425896847
_llvm_commit=5836324d6443a62ed09b84c125029e98324978c3
_glslang_commit=2fb89a0072ae7316af1c856f22663fde4928128a
_SPIRV_Tools_commit=895927bd3f2d653f40cebab55aa6c7eabde30a86
_SPIRV_Headers_commit=3fdabd0da2932c276b25b9b4a988ba134eba1aa6
_zlib_commit=cacf7f1d4e3d44d871b605da3b647f07d718623f
_hidapi_commit=01f601a1509bf9c67819fbf521df39644bab52d5
_pugixml_commit=08b3433180727ea2f78fe02e860a08471db1e03c
_xxHash_commit=94e5f23e736f2bb67ebdf90727353e65344f9fc0
_yaml_cpp_commit=0b67821f307e8c6bf0eba9b6d3250e3cf1441450
_libpng_commit=a40189cf881e9f0db80511c382292a5604c3c3d1
_FAudio_commit=28528bc885581bad58050517d78848cb206b2aa3
_curl_commit=c7aef0a945f9b6fb6d3f91716a21dfe2f4ea635f
_wolfssl_commit=723ed009ae5dc68acc14cd7664f93503d64cd51d
wrksrc="rpcs3-${_rpcs3_commit}"
archs="x86_64*" # The build system (and probably some code) assumes x86_64
build_style=cmake
configure_args="-DUSE_SYSTEM_FFMPEG=ON -DUSE_SYSTEM_LIBUSB=ON -DUSE_SYSTEM_CURL=ON
 -DCMAKE_BUILD_TYPE=Release -DUSE_SYSTEM_ZLIB=ON -DUSE_SYSTEM_LIBPNG=ON"
hostmakedepends="python3 pkg-config $(vopt_if clang clang)"
makedepends="zlib-devel qt5-devel Vulkan-Headers SDL2-devel libopenal-devel
 flatbuffers-devel glew-devel libatomic-devel ffmpeg-devel libcurl-devel"
short_desc="PS3 emulator"
maintainer="John <me@johnnynator.dev>"
license="GPL-3.0-or-later"
homepage="https://rpcs3.net/"
distfiles="https://github.com/RPCS3/rpcs3/archive/${_rpcs3_commit}.tar.gz
 https://github.com/kobalicek/asmjit/archive/${_asmjit_commit}.tar.gz
 https://github.com/RPCS3/llvm-mirror/archive/${_llvm_commit}.tar.gz
 https://github.com/KhronosGroup/glslang/archive/${_glslang_commit}.tar.gz
 https://github.com/KhronosGroup/SPIRV-Tools/archive/${_SPIRV_Tools_commit}.tar.gz
 https://github.com/KhronosGroup/SPIRV-Headers/archive/${_SPIRV_Headers_commit}.tar.gz
 https://github.com/RPCS3/hidapi/archive/${_hidapi_commit}.tar.gz
 https://github.com/zeux/pugixml/archive/${_pugixml_commit}.tar.gz
 https://github.com/Cyan4973/xxHash/archive/${_xxHash_commit}.tar.gz
 https://github.com/RPCS3/yaml-cpp/archive/${_yaml_cpp_commit}.tar.gz
 https://github.com/FNA-XNA/FAudio/archive/${_FAudio_commit}.tar.gz
 https://github.com/RipleyTom/wolfssl/archive/${_wolfssl_commit}.tar.gz"
checksum="0bcacfb57f3f014e1fcc9c62ee0728182822a5c25c64b89b0b92b5283f439ca6
 e3e48a40b0614619739e78e2443c042aab5b7486b45f1d015d7fc6a8abb5a4e4
 78ee5bb5ec0f735f68515674ac0332f77329c4a55a7dddc8c44ceccaaa94cf08
 a79adba915214c91425f9f7aa6b70ad93406ed2e0d70567481c5a3977bb0c3de
 4327ea5a7e98979061bd229ff87763d5963acf696e145c5b99b0b3e5cb425d5e
 61874b108c90ba17e7cde74b92a40bf1cf6ce6d66a30c5ea932e9cfb5df94dc4
 2c0062e0fc412ce9a8d506ec2d8b1d4de6a0305622a64a8a14d355a58f40f3ac
 490a831e7729d706dca633d2394ae529dec883a84284e0d36abf94e1ecefb6c9
 3de01e4f8c60d84907a2ce65b6528be999c0a9331be719ae3671102d0e1a5ccc
 50b15f36d069bef7f61adb4cfa179447784ebf0f6e4070ad68fce626c8f8b2eb
 092c2a360b1df770d788aba4689e6e048bbcfe45afba7198ecb7b3e2dd56b28f
 883f290c018110bd2218b8264dc5463b31803768f7bd9d5fff51c2d55cfb55d2"
nopie=yes

build_options="clang"
build_options_default="clang"

pre_configure() {
	if [ "$build_option_clang" ]; then
		export CC=clang
		export CXX=clang++
		export AR=llvm-ar
		export NM=llvm-nm
	fi
}


post_extract() {
	rmdir -v ${wrksrc}/3rdparty/asmjit/asmjit
	mv ${wrksrc}/../asmjit-${_asmjit_commit} ${wrksrc}/3rdparty/asmjit/asmjit
	rmdir -v ${wrksrc}/llvm
	mv ${wrksrc}/../llvm-mirror-${_llvm_commit} ${wrksrc}/llvm
	rmdir -v ${wrksrc}/3rdparty/glslang/glslang
        mv ${wrksrc}/../glslang-${_glslang_commit} ${wrksrc}/3rdparty/glslang/glslang
        rmdir -v ${wrksrc}/3rdparty/SPIRV/SPIRV-Tools
        mv ${wrksrc}/../SPIRV-Tools-${_SPIRV_Tools_commit} ${wrksrc}/3rdparty/SPIRV/SPIRV-Tools
        rmdir -v ${wrksrc}/3rdparty/SPIRV/SPIRV-Headers
        mv ${wrksrc}/../SPIRV-Headers-${_SPIRV_Headers_commit} ${wrksrc}/3rdparty/SPIRV/SPIRV-Headers
        rmdir -v ${wrksrc}/3rdparty/hidapi/hidapi
        mv ${wrksrc}/../hidapi-${_hidapi_commit} ${wrksrc}/3rdparty/hidapi/hidapi
	rmdir -v ${wrksrc}/3rdparty/pugixml
	mv ${wrksrc}/../pugixml-${_pugixml_commit} ${wrksrc}/3rdparty/pugixml
	rmdir -v ${wrksrc}/3rdparty/xxHash
	mv ${wrksrc}/../xxHash-${_xxHash_commit} ${wrksrc}/3rdparty/xxHash
	rmdir -v ${wrksrc}/3rdparty/yaml-cpp/yaml-cpp
	mv ${wrksrc}/../yaml-cpp-${_yaml_cpp_commit} ${wrksrc}/3rdparty/yaml-cpp/yaml-cpp
	rmdir -v ${wrksrc}/3rdparty/FAudio
	mv ${wrksrc}/../FAudio-${_FAudio_commit} ${wrksrc}/3rdparty/FAudio
	rmdir -v ${wrksrc}/3rdparty/wolfssl/wolfssl
	mv ${wrksrc}/../wolfssl-${_wolfssl_commit} ${wrksrc}/3rdparty/wolfssl/wolfssl
}
