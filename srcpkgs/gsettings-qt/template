# Template file for 'gsettings-qt'
pkgname=gsettings-qt
version=0.2
revision=1
build_style=qmake
wrksrc="gsettings-qt-v${version}"
hostmakedepends="qt5-qmake pkg-config qt5-declarative"
makedepends="qt5-devel qt5-declarative-devel glib-devel"
short_desc="Qml bindings for GSettings"
maintainer="John <me@johnnynator.dev>"
license="LGPL-3.0-only"
homepage="https://launchpad.net/gsettings-qt"
distfiles="$DEBIAN_SITE/main/g/gsettings-qt/gsettings-qt_${version}.orig.tar.gz"
checksum=1ee20cc73f0c3c6afc6910e6b60fd1236e6bcc42920f7b2442aca208914cd7f8
nocross=yes
# some things do get wrongly installed into $DESTDOR/$XBPS_CROSS_BASE

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-devel qt5-declarative-devel"
fi

pre_configure() {
	#disable generation for qmltypes file while cross building
	#also makes trouble x86_64-musl so just remove it for everything
	if [ "$CROSS_BUILD" ] || [ "${XBPS_TARGET_MACHINE#*-musl}" != "$XBPS_TARGET_MACHINE" ];then
		sed -i -e '/qmltypes/ d' GSettings/gsettings-qt.pro
	fi
}

post_install() {
	rm -r ${DESTDIR}/usr/tests
}

gsettings-qt-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}
