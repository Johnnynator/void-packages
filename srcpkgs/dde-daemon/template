# Template file for 'dde-daemon'
pkgname=dde-daemon
version=3.27.2.2
revision=1
build_style=gnu-makefile
nopie=yes
nostrip=yes
make_build_args="GOPATH=/usr/share/gocode"
hostmakedepends="dde-api go git pkg-config deepin-go-lib go-gir-generator
 deepin-gettext-tools dbus-factory python3 librsvg-utils go-dbus-factory"
makedepends="libglib-devel pam-devel alsa-lib-devel gtk+3-devel
 libXcursor-devel libXi-devel libX11-devel eudev-libudev-devel
 pulseaudio-devel libnl3-devel libinput-devel librsvg-devel libxkbfile-devel
 cairo-devel elogind-devel"
depends="deepin-desktop-schemas deepin-notifications dnsmasq gnome-keyring
 NetworkManager polkit-gnome udisks2 upower xdotool"
short_desc="Daemon handling the DDE session settings"
maintainer="John <johnz@posteo.net>"
license="GPL-3-or-later"
#changelog="https://github.com/linuxdeepin/dde-daemon/blob/${version}/CHANGELOG.md"
homepage="https://github.com/linuxdeepin/dde-daemon"
distfiles="https://github.com/linuxdeepin/dde-daemon/archive/${version}.tar.gz"
checksum=d3a1c0a259c51e59ddc37131ac1290c08a0110e74c2a87a5f78b29d9a2e17002

do_configure() {
	export GOPATH="${wrksrc}/gopath:/usr/share/gocode"
	go get github.com/axgle/mahonia
	go get github.com/BurntSushi/freetype-go/freetype/truetype
	go get github.com/BurntSushi/graphics-go/graphics
	go get github.com/BurntSushi/xgb
	go get github.com/BurntSushi/xgbutil
	go get github.com/cryptix/wav
	go get github.com/linuxdeepin/go-x11-client
	go get github.com/msteinert/pam
	go get github.com/nfnt/resize
	go get golang.org/x/image/bmp
	go get golang.org/x/image/tiff
	go get golang.org/x/text/encoding/charmap
	go get gopkg.in/alecthomas/kingpin.v2
	go get golang.org/x/net/context
	go get github.com/gosexy/gettext
	make prepare
	sed -i 's#/usr/share/backgrounds/default_background.jpg#/usr/share/backgrounds/deepin/desktop.jpg#' accounts/user.go
}

post_install() {
	rm -rf ${DESTDIR}/lib
}

#TODO: remove systemd stuff
