# Template file for 'deepin-terminal'
pkgname=deepin-terminal
version=5.2.11
revision=1
build_style=cmake
build_helper="gir"
configure_args="-DTEST_BUILD=OFF -DUSE_VENDOR_LIB=OFF"
hostmakedepends="qt5-qmake qt5-host-tools lxqt-build-tools pkg-config"
makedepends="qt5-devel qt5-tools-devel at-spi2-core-devel dtkcore-devel
 dde-qt-dbus-factory-devel dtkwidget-devel libglib-devel dtkgui-devel"
depends="qt5integration expect"
short_desc="Deepin Terminal"
maintainer="John <me@johnnynator.dev>"
license="GPL-3.0-or-later"
homepage="https://github.com/linuxdeepin/deepin-terminal"
changelog="https://github.com/linuxdeepin/deepin-terminal/blob/master/CHANGELOG.md"
distfiles="https://github.com/linuxdeepin/deepin-terminal/archive/${version}.tar.gz"
checksum=9dc2cdfda6591e616ba67ff2cdd414e1919a09104066bcef10929f6449e7d7d7

case $XBPS_TARGET_MACHINE in
	*-musl) CFLAGS="-DREG_NOERROR=REG_OK"
esac

post_patch() {
	sed -i '/<QHash>/i#include <QObject>\n#include <QMap>' 3rdparty/terminalwidget/lib/SessionManager.h
	sed -i '/LXQtCompilerSettings/a remove_definitions(-DQT_NO_CAST_FROM_ASCII -DQT_NO_CAST_TO_ASCII)' 3rdparty/terminalwidget/CMakeLists.txt
	sed -i '/#include <QTextStream>/a #include <cwctype>' 3rdparty/terminalwidget/lib/TerminalCharacterDecoder.cpp
	sed -i '/#include <QPainter>/a #include <QPainterPath>' src/customcommand/customcommanddelegate.cpp src/remotemanage/serverconfigdelegate.cpp src/theme/themeitemdelegate.cpp
	sed -i 's|default-config.json|src/assets/other/default-config.json|' CMakeLists.txt
}
