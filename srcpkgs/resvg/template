# Template file for 'resvg'
pkgname=resvg
version=0.29.0
revision=1
build_style=cargo
build_helper="rust"
hostmakedepends="cargo"
makedepends="rust-std"
short_desc="SVG rendering library written in Rust"
maintainer="Orphaned <orphan@voidlinux.org>"
license="MPL-2.0"
homepage="https://github.com/RazrFalcon/resvg"
distfiles="https://github.com/RazrFalcon/resvg/releases/download/v${version}/resvg-${version}.tar.xz"
checksum=ba82f5348899e4dc869c57dc0a616ab8bd153746abede79830d78ca9c184dd60

post_build() {
	for dir in c-api; do
		(
		cd $dir
		cargo auditable build --release --target ${RUST_TARGET}
		)
	done
}

do_install() {
	vbin target/${RUST_TARGET}/release/resvg

	# Install library as libresvg.so.0 and make the solink
	vinstall target/${RUST_TARGET}/release/libresvg.so 755 usr/lib libresvg.so.0
	ln -rs "${DESTDIR}"/usr/lib/libresvg.so.0 "${DESTDIR}"/usr/lib/libresvg.so

	vinstall c-api/resvg.h 644 usr/include
	vinstall c-api/ResvgQt.h 644 usr/include
}

libresvg0_package() {
	short_desc+=" - resvg library"
	pkg_install() {
		 vmove "usr/lib/libresvg.so.*"
	}
}

libresvg-devel_package() {
	depends="libresvg0-${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
	}
}
